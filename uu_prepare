#!/bin/sh /etc/rc.common

START=99

start() {
  # Configure loopback
  echo "config interface 'loopback'
    option ifname 'lo'
    option proto 'static'
    option ipaddr '127.0.0.1'
    option netmask '255.0.0.0'

config interface 'lan'
    option type 'bridge'
    option ifname 'eth0'
    option proto 'static'
    option ipaddr '$UU_LAN_IPADDR'
    option gateway '$UU_LAN_GATEWAY'
    option netmask '$UU_LAN_NETMASK'
    list dns '$UU_LAN_DNS'" > /etc/config/network

  # Restart network to apply changes
  /etc/init.d/network restart

  # Configure DHCP and DNS (optional but kept for compatibility)
  uci set dhcp.lan.ignore=1
  uci commit dhcp
  /etc/init.d/dnsmasq restart

  /etc/init.d/network restart
  /etc/init.d/dnsmasq restart
  
  sleep 2

  # Ensure UU Plugin is running
  # The IPK installation should have enabled it, but we start it here to be sure
  /etc/init.d/uuplugin start
}
